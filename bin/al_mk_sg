#!/usr/bin/env python
import sys
import os
import argparse
from pymongo import Connection

# Hack in case the python path is not set correctly
sys.path.append(os.path.dirname(
        os.path.abspath(sys.argv[0])) + os.sep + os.pardir + os.sep + "algolab")

from algolab.cmdutil import defaultparser
from algolab.stations import build_station_collection


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Station Graph Generation Tool",
                                     parents=[defaultparser()])
    parser.add_argument("-s", "--stations-file", type=str, default="data/Stations.txt",
                        help="path to station file (Stations.txt)")
    parser.add_argument("-r", "--routes-file", type=str, default="data/sgrv.csv",
                        help="path to routes file (sgrv.csv)")
    parser.add_argument("--base-collection", type=str, default="railway_graph",
                        dest="base_collection", help="base collection")
    parser.add_argument("--target-collection", type=str, default="station_graph",
                        dest="target_collection", help="target collection")
    args = parser.parse_args()

    db = Connection(args.host, args.port)[args.db]
    base = db[args.base_collection]
    target = db[args.target_collection]

    build_station_collection(base, target, args.stations_file, args.routes_file)
